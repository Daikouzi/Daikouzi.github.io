<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë©”ë‰´ ì¡°íšŒ</title>
  <link rel="stylesheet" href="assets/vendor/bootstrap/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container mt-4">
    <!--<h1 class="mb-4">ë©”ë‰´ ì¡°íšŒ</h1> -->

    <!-- ê²€ìƒ‰ í¼ ì˜ì—­ -->
    <div class="card p-4">
      <div class="row">
        <div class="col-md-3">
          <label for="siteId" class="form-label">ì‚¬ì—…ì¥</label>
          <select id="siteId" class="form-select">
            <option value="2" selected>Seojin System</option>
            <option value="3">TEXON</option>
            <option value="4">4ë²ˆ ì‚¬ì—…ì¥</option>
            <option value="5">5ë²ˆ ì‚¬ì—…ì¥</option>
            <option value="6">6ë²ˆ ì‚¬ì—…ì¥</option>
            <option value="7">7ë²ˆ ì‚¬ì—…ì¥</option>
            <option value="8">Ho Jeong TS</option>
            <option value="9">KDA</option>
            <option value="10">10ë²ˆ ì‚¬ì—…ì¥</option>
            <option value="11">CHITWING</option>
            <option value="12">HS TECH</option>
          </select>
        </div>

        <div class="col-md-3">
          <label for="menuDate" class="form-label">ë‚ ì§œ</label>
          <input type="date" id="menuDate" class="form-control" />
        </div>

        <div class="col-md-3">
          <label for="categoryId" class="form-label">ì‹ì‚¬</label>
          <select id="categoryId" class="form-select">
            <option value="2">ì¡°ì‹</option>
            <option value="3" selected>ì¤‘ì‹</option>
            <option value="4">ì„ì‹</option>
            <option value="5">ì•¼ì‹</option>
          </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
          <button class="btn btn-primary w-100" onclick="loadMenu()">
            ê²€ìƒ‰
          </button>
        </div>
      </div>
    </div>

    <!-- ê²°ê³¼ ì¶œë ¥ ì˜ì—­ -->
    <div id="output" class="mt-4"></div>

  <script>
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚ ì§œë¥¼ ì˜¤ëŠ˜ë¡œ ê¸°ë³¸ ì„¤ì •
  document.addEventListener("DOMContentLoaded", () => {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    document.getElementById("menuDate").value = `${yyyy}-${mm}-${dd}`;
  });

  function loadMenu() {
    const siteId = document.getElementById("siteId").value;
    const categoryId = document.getElementById("categoryId").value;
    const date = document.getElementById("menuDate").value;

    if (!date) {
      alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
      return;
    }

    const url = `https://pvbi.ddns.net/api/korean-menu?date=${date}&siteId=${siteId}&categoryId=${categoryId}`;
    const outputEl = document.getElementById("output");

    // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
    outputEl.innerHTML = `
      <div class="d-flex justify-content-center mt-5">
        <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    `;

    fetch(url, {
      method: "GET",
      headers: {
        "X-API-KEY": "l0vLjDuIxAAUjHd7"
      }
    })
      .then(res => {
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        return res.json();
      })
      .then(data => {
        outputEl.innerHTML = ""; // ìŠ¤í”¼ë„ˆ ì œê±°

        console.log("API ì‘ë‹µ:", data);

        if (!data || !Array.isArray(data.data) || data.data.length === 0) {
          outputEl.innerHTML = `
            <div class="alert alert-warning" role="alert">
              í•´ë‹¹ ë‚ ì§œì˜ ë©”ë‰´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
          `;
          return;
        }

        const menuItems = data.data; // ì§€ê¸ˆ êµ¬ì¡°ì—ì„œëŠ” ë°°ì—´ ì•ˆì— 1ê±´ì´ì§€ë§Œ, í™•ì¥ ê³ ë ¤í•´ì„œ ê·¸ëŒ€ë¡œ ì‚¬ìš©

        const cardsHtml = menuItems
          .map(item => {
            // í•œêµ­ì–´ ë©”ë‰´ ëª¨ìœ¼ê¸°
            const koreanList = [];
            for (let i = 1; i <= 10; i++) {
              const val = item[`menu_name_k_${i}`];
              if (val && val.trim() !== "") {
                koreanList.push(val.trim());
              }
            }

            // ë² íŠ¸ë‚¨ì–´ ë©”ë‰´ ëª¨ìœ¼ê¸°
            const vietnameseList = [];
            for (let i = 1; i <= 10; i++) {
              const val = item[`menu_name_v_${i}`];
              if (val && val.trim() !== "") {
                vietnameseList.push(val.trim());
              }
            }

            const koreanMenu = koreanList.length > 0
              ? koreanList.join("<br>")
              : "ì •ë³´ ì—†ìŒ";

            const vietnameseMenu = vietnameseList.length > 0
              ? vietnameseList.join("<br>")
              : "ì •ë³´ ì—†ìŒ";

            const headerTitle = `${item.workplace_name || ""} - ${item.category_name_k || ""}`.trim() || "ë©”ë‰´";

            return `
              <div class="col">
                <div class="card h-100">
                  <div class="card-header">
                    ${headerTitle}
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">ğŸ‡°ğŸ‡· í•œêµ­ì–´ ë©”ë‰´</h5>
                    <p class="card-text">${koreanMenu}</p>
                    <hr>
                    <h5 class="card-title">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨ì–´ ë©”ë‰´</h5>
                    <p class="card-text">${vietnameseMenu}</p>
                    <hr>
                    <p class="text-muted mb-0">
                      ë‚ ì§œ: ${item.apply_date || "-"}
                    </p>
                  </div>
                </div>
              </div>
            `;
          })
          .join("");

        outputEl.innerHTML = `
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            ${cardsHtml}
          </div>
        `;
      })
      .catch(err => {
        console.error(err);
        outputEl.innerHTML = `
          <div class="alert alert-danger" role="alert">
            ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}
          </div>
        `;
      });
  }
</script>
</body>
</html>
